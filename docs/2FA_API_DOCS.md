# Документация по API для двухфакторной аутентификации (2FA)

## Обзор

Этот документ описывает API для работы с двухфакторной аутентификацией в приложении. API позволяет настраивать, включать, отключать и управлять резервными кодами для 2FA.

## Базовый URL

```
https://api.yourapp.com/api/v1
```

## Аутентификация

Все запросы к API (кроме публичных эндпоинтов) требуют аутентификации с помощью JWT токена, который должен быть передан в заголовке `Authorization`:

```
Authorization: Bearer ваш_jwt_токен
```

## Коды ответов

- `200 OK` - запрос выполнен успешно
- `400 Bad Request` - неверные параметры запроса
- `401 Unauthorized` - требуется аутентификация
- `403 Forbidden` - доступ запрещен
- `404 Not Found` - ресурс не найден
- `429 Too Many Requests` - превышено количество попыток

## Эндпоинты

### 1. Настройка 2FA

Генерирует секретный ключ и резервные коды для настройки 2FA.

```
POST /2fa/setup
```

#### Параметры запроса

Нет параметров в теле запроса.

#### Пример успешного ответа (200 OK)

```json
{
  "qr_code_url": "data:image/png;base64,...",
  "secret_key": "SECRET1234567890",
  "backup_codes": ["CODE1", "CODE2", "CODE3"]
}
```

#### Ошибки

- `400 Bad Request` - 2FA уже настроена для этого аккаунта
- `401 Unauthorized` - требуется аутентификация

---

### 2. Активация 2FA

Активирует 2FA после подтверждения кода из приложения аутентификатора.

```
POST /2fa/enable
```

#### Параметры запроса

```json
{
  "code": "123456"
}
```

#### Пример успешного ответа (200 OK)

```json
{
  "message": "Двухфакторная аутентификация успешно активирована"
}
```

#### Ошибки

- `400 Bad Request` - неверный код подтверждения или 2FA уже активирована
- `401 Unauthorized` - требуется аутентификация
- `429 Too Many Requests` - превышено количество попыток ввода кода

---

### 3. Отключение 2FA

Отключает 2FA для текущего пользователя.

```
POST /2fa/disable
```

#### Параметры запроса

```json
{
  "password": "ваш_пароль",
  "code": "123456"
}
```

#### Пример успешного ответа (200 OK)

```json
{
  "message": "Двухфакторная аутентификация успешно отключена"
}
```

#### Ошибки

- `400 Bad Request` - неверный пароль или код подтверждения
- `401 Unauthorized` - требуется аутентификация
- `403 Forbidden` - требуется подтверждение 2FA

---

### 4. Получение статуса 2FA

Возвращает текущий статус двухфакторной аутентификации пользователя.

```
GET /2fa/status
```

#### Параметры запроса

Нет параметров в теле запроса.

#### Пример успешного ответа (200 OK)

```json
{
  "is_2fa_enabled": true,
  "is_2fa_setup": true,
  "backup_codes_remaining": 3,
  "last_2fa_change": "2025-09-04T10:30:00Z"
}
```

#### Ошибки

- `401 Unauthorized` - требуется аутентификация

---

### 5. Генерация новых резервных кодов

Генерирует новые резервные коды для двухфакторной аутентификации.

```
POST /2fa/regenerate-backup-codes
```

#### Заголовки

- `X-2FA-Code` - код подтверждения из приложения аутентификатора (требуется, если 2FA включена)

#### Параметры запроса

Нет параметров в теле запроса.

#### Пример успешного ответа (200 OK)

```json
{
  "backup_codes": ["NEW1", "NEW2", "NEW3"]
}
```

#### Ошибки

- `400 Bad Request` - 2FA не настроена
- `401 Unauthorized` - требуется аутентификация
- `403 Forbidden` - требуется подтверждение 2FA

## Безопасность

- Все запросы должны выполняться по HTTPS
- JWT токены должны храниться безопасно на стороне клиента
- Резервные коды должны быть показаны пользователю только один раз и сохранены в безопасном месте
- После 5 неудачных попыток ввода кода 2FA аккаунт блокируется на 15 минут

## Примеры использования

### Настройка 2FA

1. Пользователь запрашивает настройку 2FA через `POST /2fa/setup`
2. Сканирует QR-код в приложении аутентификатора
3. Вводит код из приложения в `POST /2fa/enable`
4. Сохраняет резервные коды в безопасном месте

### Аутентификация с 2FA

1. Пользователь вводит логин и пароль
2. Если 2FA включена, сервер возвращает `requires_2fa: true`
3. Пользователь вводит код из приложения аутентификатора
4. Сервер проверяет код и выдает токены доступа

## Обратная связь

По всем вопросам и предложениям обращайтесь в службу поддержки: support@yourapp.com
