# Руководство по развертыванию WebKarmaApp

## Требования

- Docker и Docker Compose
- Учетная запись на Railway или другом хостинге
- Учетная запись на Docker Hub (опционально)
- GitHub репозиторий

## Настройка окружения

1. Создайте файл `.env` в корне проекта:

```env
# Основные настройки
SECRET_KEY=ваш-секретный-ключ
ENVIRONMENT=production

# База данных
DATABASE_URL=postgresql://user:password@host:port/dbname

# Sentry (опционально)
SENTRY_DSN=ваш-dsn-от-sentry
```

## Развертывание на Railway

### Подготовка

1. Установите Railway CLI:
```bash
npm i -g @railway/cli
```

2. Авторизуйтесь:
```bash
railway login
```

### Развертывание

1. Создайте новый проект в Railway:
```bash
railway init
```

2. Добавьте необходимые сервисы (PostgreSQL, Redis и т.д.)

3. Настройте переменные окружения:
```bash
railway env upload .env
```

4. Запустите деплой:
```bash
railway up
```

## CI/CD с GitHub Actions

### Необходимые секреты

Добавьте следующие секреты в настройках вашего GitHub репозитория (Settings -> Secrets -> Actions):

- `RAILWAY_TOKEN` - Токен доступа Railway
- `DOCKERHUB_USERNAME` - Имя пользователя Docker Hub
- `DOCKERHUB_TOKEN` - Токен доступа Docker Hub
- `DATABASE_URL` - Строка подключения к БД

### Процесс деплоя

1. При пуше в ветку `main` автоматически запускается пайплайн
2. Выполняются тесты
3. Собирается Docker-образ
4. Образ загружается в Docker Hub
5. Приложение развертывается на Railway

## Мониторинг

После развертывания доступны:

- Медики: `https://ваш-домен/health`
- Метрики: `https://ваш-домен/metrics`
- Логи: доступны в панели Railway

## Обновление

Для обновления приложения:

1. Сделайте изменения в коде
2. Создайте Pull Request
3. После успешного прохождения тестов смерджите PR в `main`
4. Автоматически запустится процесс деплоя

## Аварийное восстановление

Для отката на предыдущую версию:

1. В панели Railway перейдите в раздел "Deployments"
2. Выберите стабильную версию
3. Нажмите "Redeploy"

## Контакты

По вопросам развертывания обращайтесь к команде разработки.
